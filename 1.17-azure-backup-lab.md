
# ðŸ”¹ Azure Backup Lab Exercise (Azure Portal GUI)

---

## **Part 1 â€“ Create Networking and VM**

1. **Create Resource Group**

   * Azure Portal â†’ **Resource Groups â†’ Create**
   * Name: `studentname_rg`
   * Region: (your choice, e.g., Central India).

2. **Create Virtual Network**

   * Resource Group: `studentname_rg`
   * Name: `studentname_vnet`
   * Address Space: `10.0.0.0/16`
   * Subnet: `studentname_subnet` (10.0.1.0/24).

3. **Create Linux VM**

   * Azure Portal â†’ **Virtual Machines â†’ Create VM**.
   * Name: `studentname_vm1`
   * Resource Group: `studentname_rg`
   * Image: Ubuntu 20.04 LTS (or RHEL 8).
   * Size: Standard B1s or higher.
   * Authentication: SSH key or password.
   * Network: Use `studentname_vnet` + `studentname_subnet`.
   * Public inbound ports: Allow **SSH (22)** + **HTTP (80)**.

   âœ… Once created, connect to VM via SSH:

   ```bash
   ssh azureuser@<VM_Public_IP>
   ```

4. **Attach Data Disk**

   * VM â†’ **Disks â†’ Add Data Disk â†’ Create New (20 GB)** â†’ Save.
   * Format & mount inside VM:

   ```bash
   lsblk
   sudo mkfs.xfs /dev/sdc
   sudo mkdir /data
   sudo mount /dev/sdc /data
   echo "/dev/sdc /data xfs defaults 0 0" | sudo tee -a /etc/fstab
   ```

5. **Install Packages**

   ```bash
   # Ubuntu
   sudo apt-get update -y
   sudo apt-get install -y apache2 wget net-tools zip unzip

   # RHEL (if chosen)
   # sudo yum install -y httpd wget net-tools zip unzip
   ```

6. **Configure Apache**

   ```bash
   echo "<h1>Azure Backup Lab - studentname_vm1</h1>" | sudo tee /var/www/html/index.html
   sudo systemctl enable --now apache2 || sudo systemctl enable --now httpd
   ```

   âœ… Open in browser: `http://<VM_Public_IP>` â†’ should display message.

7. **Add Sample Data**

   ```bash
   mkdir ~/os_lab
   echo "OS Disk File 1" > ~/os_lab/osfile1.txt

   mkdir /data/lab_data
   echo "Data Disk File 1" > /data/lab_data/datafile1.txt
   ```

---

## **Part 2 â€“ Configure Backup**

1. **Create Recovery Services Vault**

   * Resource Group: `studentname_rg`
   * Name: `studentname_rsv`
   * Region: same as VM.

2. **Create Backup Policy**

   * RSV â†’ **Backup Policies â†’ Add**.
   * Frequency: Daily
   * Retention: 7 days (lab).

3. **Enable Backup for VM**

   * VM â†’ **Backup â†’ Enable Backup**
   * Select `studentname_rsv` + policy.

4. **Trigger Backup**

   * VM â†’ **Backup â†’ Backup Now**.
   * Wait until job status is **Completed**.

---

## **Part 3 â€“ Restore Lab Exercises**

### **1. Restore New VM from Backup**

* RSV â†’ **Backup Items â†’ Azure VM â†’ studentname_vm1 â†’ Restore VM**.
* Select restore point â†’ Option: **Create new VM**.
* New VM name: `studentname_vm1_restore`.
* After deployment:

  * SSH into restored VM.
  * Validate:

    ```bash
    cat /var/www/html/index.html
    ls ~/os_lab
    ls /data/lab_data
    ```

---

### **2. Restore Disk & Swap OS/Data Disk**

**(a) Restore Disk**

* RSV â†’ **Backup Items â†’ studentname_vm1 â†’ Restore Disks**.
* Select OS disk / Data disk.
* Restore to storage account â†’ Azure creates managed disk.

**(b) Swap OS Disk**

* VM â†’ **Disks â†’ Swap OS Disk**.
* Select restored OS disk â†’ Apply.
* Restart VM â†’ Validate `index.html` + files restored.

**(c) Swap Data Disk**

* Detach corrupted `/data` disk.
* Attach restored data disk.
* Mount & check:

  ```bash
  ls /data/lab_data
  cat /data/lab_data/datafile1.txt
  ```

---

### **3. Replace Existing VM After Corruption**

**(a) Corrupt VM Files**

```bash
sudo rm -rf /var/www/html/index.html
sudo rm -rf /data/lab_data/*
```

**(b) Restore â†’ Replace Existing**

* RSV â†’ **Backup Items â†’ Restore VM â†’ Replace Existing**.
* Confirm restore point â†’ Azure overwrites VM disks.

**(c) Validate**

* SSH to same VM.
* Check files + Apache web page restored.

---

## **Part 4 â€“ Validate Storage Account**

* Go to **Storage Account** automatically created during restore.
* Check **Containers â†’ azurebackup** (backup data).
* Check **Restored Disks â†’ Managed Disks / VHDs**.
* Validate timestamps with your restore operations.

---

# âœ… Final Outcome

* Resource Group: `studentname_rg`
* VNet/Subnet: `studentname_vnet`, `studentname_subnet`
* VM: `studentname_vm1` with OS + Data disk.
* Recovery Services Vault: `studentname_rsv`.
* Backup taken and validated with:

  * New VM restore.
  * Disk restore + swap OS/Data.
  * Replace existing VM.
* Storage Account shows backup/restore artifacts.

---
