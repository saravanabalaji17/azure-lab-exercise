1. Creating an **Azure Linux VM**
2. Capturing an **image from that VM**
3. Creating a **new VM from the custom image**

Here’s a clear **lab exercise** you can follow:

---

# 🧪 Lab Exercise: Azure Linux VM → Custom Image → New VM

---

## **Step 1: Create the First Linux VM**

1. In **Azure Portal**, go to **Virtual machines → Create → Azure Virtual Machine**
2. Fill details:

   * **Resource Group**: `<studentname>-rg`
   * **VM name**: `<studentname>-linux-vm`
   * **Region**: Choose nearest
   * **Image**: AlmaLinux 9 (x64 Gen2)
   * **Authentication**: SSH public key → Generate new key pair (`<studentname>-key`)
   * **Inbound ports**: Allow SSH (22)
3. **Review + Create → Create**

👉 After deployment, SSH into the VM and install something (example Apache) so you can confirm later:

```bash
sudo dnf install -y httpd
echo "Hello from Source VM" | sudo tee /var/www/html/index.html
sudo systemctl enable --now httpd
```

Check by browsing `http://<vm-public-ip>`

---

## **Step 2: Capture Image from the VM**

1. Stop (deallocate) the VM:

   * In Portal → VM → **Stop**
2. Go to **VM → Capture**

   * **Image name**: `studentname-linux-image`
   * **Resource Group**: `<studentname>-rg`
   * Choose: **Automatically delete the VM after creating the image?** → **No** (keep it)
   * If you want reusable image: tick **This VM has been generalized** (only if deprovisioned with `waagent -deprovision+user`)
3. Click **Review + Create → Create**

Now you have a custom image saved.

---

## **Step 3: Create New VM from Custom Image**

1. Go to **Images** in Portal → Select `studentname-linux-image`
2. Click **Create VM**
3. Fill details:

   * **VM name**: `studentname-new-vm`
   * **Resource Group**: `<studentname>-rg`
   * Authentication: SSH public key
   * Networking: default or same VNet
4. Click **Review + Create → Create**

---

## **Step 4: Verify New VM**

* SSH into new VM:

```bash
ssh -i studentname-key.pem azureuser@<new-vm-public-ip>
```

* If you installed Apache in Step 1, check by browsing `http://<new-vm-public-ip>`
  → You should see the same “Hello from Source VM” page.

---

✅ **You have successfully created a Linux VM, captured an image, and launched a new VM from that image.**

---
