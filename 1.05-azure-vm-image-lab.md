

# ğŸ§ª Lab Exercise: Azure Linux VM â†’ Custom Image â†’ New VM



**Create VM â†’ Configure â†’ Capture Image â†’ Azure Compute Gallery â†’ Create VM from Image**

---



## ğŸ·ï¸ Mandatory Naming Convention

Replace **`studentname`** with your name (example: `balaji`).

| Resource              | Name                      |
| --------------------- | ------------------------- |
| Resource Group        | `studentname-rg`          |
| Source VM             | `studentname-vm`          |
| Azure Compute Gallery | `studentname-acg`         |
| Image Definition      | `studentname-img-def`     |
| Image Version         | `1.0.0`                   |
| VM from Image         | `studentname-vm-from-img` |
| Virtual Network       | `studentname-vnet`        |
| Subnet                | `studentname-subnet`      |

---

## ğŸ”¹ Step 1: Create Resource Group (GUI)

1. Login to **Azure Portal**
2. Search â†’ **Resource groups**
3. Click **Create**
4. Enter:

   * Resource group: `studentname-rg`
   * Region: **East US**
5. Click **Review + Create â†’ Create**

---

## ğŸ”¹ Step 2: Create Linux Virtual Machine (GUI)

1. Search â†’ **Virtual Machines**
2. Click **Create â†’ Azure virtual machine**

---

### ğŸ§© Basics Tab

Fill in the following:

* Resource group: `studentname-rg`
* Virtual machine name: `studentname-vm`
* Region: East US
* Availability options: No infrastructure redundancy required
* Security type: Standard
* Image: **RHEL / Rocky / CentOS / Ubuntu**
* Size: `Standard_B2s`
* Username: `azureuser`
* Authentication type: SSH public key
* SSH key: Generate new key pair

#### âœ… Allow inbound ports

Select:

* â˜‘ **SSH (22)**
* â˜‘ **HTTP (80)**

Click **Next**

---

### ğŸ§© Disks Tab

* OS disk type: Standard SSD
* Click **Next**

---

### ğŸ§© Networking Tab

* Virtual network: `studentname-vnet` (new)
* Subnet: `studentname-subnet`
* Public IP: New
* NIC network security group: Basic

ğŸ‘‰ **No need to add port rules here** (already done in Basics)

Click **Review + Create â†’ Create**

---

## ğŸ”¹ Step 3: Connect to VM

1. Open `studentname-vm`
2. Click **Connect â†’ SSH**
3. Use Azure Cloud Shell or local terminal

---

## ğŸ”¹ Step 4: Configure VM (Inside VM)

### Create directories

```bash
sudo mkdir /d1 /d2 /d3 /d4 /d5
```

Verify:

```bash
ls /
```

---

### Install required packages

#### RHEL / CentOS / Rocky

```bash
sudo yum install -y httpd wget zip net-tools
```

#### Ubuntu

```bash
sudo apt update
sudo apt install -y apache2 wget zip net-tools
```

---

### Start and enable HTTP service

```bash
sudo systemctl enable httpd
sudo systemctl start httpd
```

---

### Create test web page

```bash
echo "Welcome from studentname custom image VM" | sudo tee /var/www/html/index.html
```

Verify:

```bash
curl localhost
```

Browser:

```
http://<VM-Public-IP>
```

---

## ğŸ”¹ Step 5: Capture VM Image (GUI)

âœ… *No manual deprovision required*

1. Open `studentname-vm`
2. Click **Capture**
3. Fill details:

   * Resource group: `studentname-rg`
   * Share image to Azure Compute Gallery: **Yes**
   * Automatically delete VM after creating image: âŒ No
   * Gallery: **Create new**

     * Name: `studentname-acg`
   * Image definition: **Create new**

     * Name: `studentname-img-def`
     * OS type: Linux
     * OS state: **Generalized**
   * Image version: `1.0.0`
   * Target region: East US
4. Click **Review + Create â†’ Create**

â³ Wait until image creation completes.

---

## ğŸ”¹ Step 6: Verify Azure Compute Gallery

1. Search â†’ **Azure Compute Galleries**
2. Open `studentname-acg`
3. Confirm:

   * Image Definition exists
   * Image Version `1.0.0` status = **Succeeded**

---

## ğŸ”¹ Step 7: Create VM from Image (GUI)

1. Open **Image version `1.0.0`**
2. Click **Create VM**

### Basics

* Resource group: `studentname-rg`
* VM name: `studentname-vm-from-img`
* Size: `Standard_B2s`
* Username: `azureuser`
* SSH key: Use existing key

#### âœ… Allow inbound ports

Select:

* â˜‘ **SSH (22)**
* â˜‘ **HTTP (80)**

Click **Review + Create â†’ Create**

---

## ğŸ”¹ Step 8: Validate New VM

### SSH into new VM

```bash
ssh azureuser@<NEW-VM-PUBLIC-IP>
```

---

### Validate directories

```bash
ls /
```

Expected:

```
d1 d2 d3 d4 d5
```

---

### Validate installed packages

```bash
httpd -v
wget --version
zip -v
ifconfig
```

---

### Validate HTTP service

```bash
systemctl status httpd
curl localhost
```

Browser:

```
http://<NEW-VM-PUBLIC-IP>
```

---

## âœ… Lab Completion Checklist

âœ” VM created with ports 22 & 80 allowed
âœ” Directories d1â€“d5 exist
âœ” Packages installed (httpd, wget, zip, net-tools)
âœ” VM captured successfully
âœ” Azure Compute Gallery created
âœ” Image Definition & Version created
âœ” New VM created from image
âœ” Validation successful

---

## ğŸ§  Trainer / Interview Notes

* Ports should be planned **during VM creation**
* Capture + Compute Gallery = **Golden Image pattern**
* Image versioning enables safe upgrades & rollback

---


---
