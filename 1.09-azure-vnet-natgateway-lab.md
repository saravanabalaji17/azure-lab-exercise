
# ğŸ”¹ Lab Exercise: Azure NAT Gateway with AlmaLinux Private VM

### ğŸ¯ **Lab Goal**

* Create VNet with Public & Private Subnets
* Deploy NAT Gateway for outbound internet on private subnet
* Deploy 2 AlmaLinux VMs â†’ **Jumpbox (public)** + **Private VM (no public IP)**
* Test internet access from private VM using commands other than `ping`
* Understand **why ping doesnâ€™t work with NAT Gateway**

---

## **Step 1: Create Resource Group**

1. Go to **Azure Portal â†’ Resource groups â†’ Create**
2. Name: `studentname-nat-rg`
3. Region: Choose closest region
4. **Create**

---

## **Step 2: Create Virtual Network**

1. Go to **Virtual Networks â†’ Create**
2. Name: `studentname-vnet`
3. Address space: `10.0.0.0/16`
4. Subnets:

   * `public-subnet` â†’ `10.0.1.0/24`
   * `private-subnet` â†’ `10.0.2.0/24`
5. **Create**

---

## **Step 3: Create NAT Gateway**

1. Go to **NAT Gateways â†’ Create**
2. Name: `studentname-natgw`
3. Public IP: Create new â†’ Name `studentname-nat-ip` â†’ SKU: Standard
4. Associate with **private-subnet**
5. **Create**

---

## **Step 4: Create AlmaLinux Jumpbox VM**

1. Go to **Virtual Machines â†’ Create**
2. Name: `studentname-jumpbox`
3. Image: **AlmaLinux 9.x**
4. Size: Standard\_B1s
5. Authentication: Password or SSH Key
6. Networking:

   * VNet: `studentname-vnet`
   * Subnet: `public-subnet`
   * Public IP: Yes
7. **Create**

---

## **Step 5: Create AlmaLinux Private VM**

1. Go to **Virtual Machines â†’ Create**
2. Name: `studentname-private-alma`
3. Image: **AlmaLinux 9.x**
4. Size: Standard\_B1s
5. Authentication: Password or SSH Key
6. Networking:

   * VNet: `studentname-vnet`
   * Subnet: `private-subnet`
   * Public IP: **None**
7. **Create**

---

## **Step 6: Connect to VMs**

1. From local system â†’ SSH into Jumpbox:

   ```bash
   ssh almauser@<Jumpbox-Public-IP>
   ```
2. From Jumpbox â†’ SSH into Private VM:

   ```bash
   ssh almauser@10.0.2.4
   ```

---

## **Step 7: Test Internet Access on Private VM**

> âš ï¸ `ping` will fail because NAT Gateway does **not** support ICMP. Use these instead:

```bash
# Update packages (requires internet)
sudo dnf update -y

# Install curl and wget
sudo dnf install -y curl wget

# Check outbound public IP (should be NAT Gateway IP)
curl ifconfig.me

# Test HTTPS connectivity
curl -I https://www.google.com

# Download test file
wget http://speedtest.tele2.net/1MB.zip -O /dev/null

# Test DNS resolution
dig google.com
```

âœ… If these commands succeed, your private VM has internet access via NAT Gateway.

---

## **Step 8: Verify in Azure**

1. Go to **NAT Gateway â†’ Metrics**
2. Check **SNAT connections** and **Data processed** â€“ traffic should appear from your private VM.

---

## â“ Why Ping Doesnâ€™t Work with NAT Gateway

* NAT Gateway supports **only TCP & UDP outbound connections**.
* **ICMP (used by ping)** is **not translated** by NAT Gateway.
* Thatâ€™s why `ping google.com` fails, but `curl/wget/dnf` works fine.

---
