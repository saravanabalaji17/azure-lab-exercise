
---

# ðŸ”¹ Lab Exercise â€“ Azure Application Gateway with Web Servers, Certificate, and DNS Zone

### **Goal**

Deploy two Linux web servers, configure an Application Gateway with HTTP & HTTPS listeners, create a PFX certificate, add a DNS zone for friendly access, and test both HTTP & HTTPS traffic.

---

## **1. Create Resource Group**

* **Name:** `studentname-rg`
* **Region:** East US (or nearest region)

---

## **2. Create Two Linux VMs (Web Servers)**

1. Go to **Virtual Machines â†’ Create**

   * **Name:** `studentname-vm1`
   * Image: Ubuntu LTS
   * Size: Standard\_B1s
   * Authentication: Password/SSH
   * Networking: Place in **`studentname-vnet`** (create if not existing), subnet `web-subnet`
   * Allow inbound ports: HTTP (80), SSH (22)

   Repeat for **`studentname-vm2`**.

2. **Install Apache & HTML content** on each VM:

   SSH into `studentname-vm1`:

   ```bash
   sudo apt update
   sudo apt install -y apache2
   echo "<h1>Welcome to Web Server 1</h1>" | sudo tee /var/www/html/index.html
   ```

   SSH into `studentname-vm2`:

   ```bash
   sudo apt update
   sudo apt install -y apache2
   echo "<h1>Welcome to Web Server 2</h1>" | sudo tee /var/www/html/index.html
   ```

   âœ… Test in browser with public IPs:

   * `http://<vm1-public-ip>` â†’ Web Server 1
   * `http://<vm2-public-ip>` â†’ Web Server 2

---

## **3. Create Virtual Network**

* **Name:** `studentname-vnet`
* Subnets:

  * `web-subnet` â†’ VMs
  * `appgw-subnet` â†’ Application Gateway

---

## **4. Create Application Gateway**

1. Go to **Create Resource â†’ Application Gateway**

   * **Name:** `studentname-appgw`
   * **Tier:** Standard\_v2
   * **Frontend IP:** Public
   * **VNet:** `studentname-vnet`
   * **Subnet:** `appgw-subnet`

2. Configure **Backend Pool**:

   * Add targets = private IPs of `studentname-vm1` and `studentname-vm2`

3. Configure **Backend Settings**:

   * Port: 80
   * Protocol: HTTP

4. Configure **Listener (HTTP)**:

   * Listener name: `http-listener`
   * Protocol: HTTP
   * Port: 80

5. Configure **Rule**:

   * Route all HTTP requests to backend pool.

âœ… Test: `http://<appgw-public-ip>` â†’ Should load balance between VM1 and VM2.

---

## **5. Create Self-Signed PFX Certificate**

Run in Cloud Shell or local Linux:

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout studentname.key -out studentname.crt
```

Export PFX:

```bash
openssl pkcs12 -export -out studentname.pfx -inkey studentname.key -in studentname.crt
```

Enter an export password â†’ note it.

---

## **6. Create HTTPS Listener**

1. In **Application Gateway â†’ Listeners â†’ Add**

   * Name: `https-listener`
   * Protocol: HTTPS
   * Port: 443
   * Upload certificate: `studentname.pfx` + password

2. Add new **Routing Rule**:

   * Listener = `https-listener`
   * Backend Pool = `studentname-vm1`, `studentname-vm2`
   * Backend Settings = Port 80

âœ… Test:

* `https://<appgw-public-ip>` â†’ Should load balance between VM1 and VM2

---

## **7. Create DNS Zone**

1. Go to **Create Resource â†’ DNS Zone**

   * Name: `studentname.com`
   * Resource Group: `studentname-rg`

2. Inside DNS Zone, add **A record**:

   * Name: `www`
   * Type: A
   * Value: `<appgw-public-ip>`

---

## **8. Test with DNS**

* Browse: `http://www.studentname.com` â†’ VM1 or VM2 (round-robin)
* Browse: `https://www.studentname.com` â†’ Secure connection using uploaded certificate

---

## âœ… Deliverables

1. Screenshots of:

   * VM HTML pages in browser
   * App Gateway backend pool with VMs
   * HTTP + HTTPS listeners
   * DNS Zone with A record
   * Successful `http://www.studentname.com` and `https://www.studentname.com`

---

* VMs in web subnet
* App Gateway in appgw-subnet
* DNS Zone â†’ App Gateway Public IP â†’ Backend pool (VM1 & VM2)?


