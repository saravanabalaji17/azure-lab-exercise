
---

# ðŸ”¹ **Azure Identity, CLI, and VM Deployment Lab**

---

## **Part 1 â€“ Create User & Assign Owner Role**

### (A) **Using GUI (Azure Portal)**

1. Go to **Azure Portal â†’ Microsoft Entra ID â†’ Users â†’ New User**

   * Enter name: `labuser1`
   * UPN: `labuser1@<yourtenant>.onmicrosoft.com`
   * Auto-generate password â†’ Save.

2. Go to **Subscriptions â†’ Select Subscription â†’ Access Control (IAM)**

   * Click **Add role assignment**
   * Role = **Owner**
   * Assign to `labuser1`.

---

### (B) **Using Azure CLI**

(Admin account required)

```bash
# Create user
az ad user create \
  --display-name "Lab User 1" \
  --user-principal-name labuser1@<yourtenant>.onmicrosoft.com \
  --password "Pass@12345"

# Assign Owner role
az role assignment create \
  --assignee labuser1@<yourtenant>.onmicrosoft.com \
  --role Owner \
  --scope /subscriptions/<subscription-id>
```

---

## **Part 2 â€“ Install Azure CLI on Linux**

(Ubuntu/Debian example)

```bash
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
az version
```

---

## **Part 3 â€“ Login & Verify**

```bash
# Login
az login

# Show logged-in user
az account show --query user

# List assigned roles
az role assignment list \
  --assignee $(az account show --query user.name -o tsv) -o table
```

---

## **Part 4 â€“ Manage Subscription**

```bash
# List subscriptions
az account list -o table
az account show

# Set subscription
az account set --subscription <subscription-id>
```

---

## **Part 5 â€“ Create Resource Group, VNet, Subnet and NSG and allow SSH (22), HTTP (80), RDP (3389)**

```bash
# Create Resource Group
az group create --name demo-rg --location eastus

# Create VNet and Subnet
az network vnet create \
  --resource-group demo-rg \
  --name demo-vnet \
  --address-prefix 10.0.0.0/16 \
  --subnet-name demo-vnet-subnet \
  --subnet-prefix 10.0.1.0/24



az network nsg create \
  --resource-group demo-rg \
  --name demo-nsg

Add rules:

az network nsg rule create \
  --resource-group demo-rg \
  --nsg-name demo-nsg \
  --name Allow-SSH \
  --priority 100 \
  --access Allow \
  --protocol Tcp \
  --direction Inbound \
  --destination-port-ranges 22

az network nsg rule create \
  --resource-group demo-rg \
  --nsg-name demo-nsg \
  --name Allow-HTTP \
  --priority 110 \
  --access Allow \
  --protocol Tcp \
  --direction Inbound \
  --destination-port-ranges 80

az network nsg rule create \
  --resource-group demo-rg \
  --nsg-name demo-nsg \
  --name Allow-RDP \
  --priority 120 \
  --access Allow \
  --protocol Tcp \
  --direction Inbound \
  --destination-port-ranges 3389

Attach NSG to Subnet

az network vnet subnet update \
  --resource-group demo-rg \
  --vnet-name demo-vnet \
  --name demo-vnet-subnet \
  --network-security-group demo-nsg
```

---

## **Part 6 â€“ Create Linux VM**

### (A) **VM with SSH Key**

```bash
az vm create \
  --resource-group demo-rg \
  --name demo-vm \
  --image Ubuntu2204 \
  --vnet-name demo-vnet \
  --subnet demo-vet-subnet \
  --admin-username azureuser \
  --generate-ssh-keys
```

---

### (B) **VM with Password**

```bash
az vm create \
  --resource-group demo-rg \
  --name LabVMPass \
  --image UbuntuLTS \
  --admin-username azureuser \
  --admin-password 'MyP@ssw0rd123' \
  --authentication-type password \
  --vnet-name demo-vnet \
  --subnet demo-vnet-Subnet
```
### (C) ** (Optional) Windows VM (RDP)**

```bash
az vm create \
  --resource-group demo-rg \
  --name demo-winvm \
  --image Win2022Datacenter \
  --vnet-name demo-vnet \
  --subnet demo-subnet \
  --admin-username azureuser \
  --admin-password "P@ssword@12345"
```
---

## **Part 7 â€“ Open Ports**

```bash
# SSH
az vm open-port --resource-group LabRG --name LabVMKey --port 22
az vm open-port --resource-group LabRG --name LabVMPass --port 22

# HTTP
az vm open-port --resource-group LabRG --name LabVMKey --port 80
az vm open-port --resource-group LabRG --name LabVMPass --port 80
```

---

## **Part 8 â€“ Install Apache (httpd)**

Get public IP:

```bash
az vm list-ip-addresses --resource-group LabRG -o table
```

SSH into VM:

```bash
ssh azureuser@<public-ip>   # (for SSH key VM)
# or
ssh azureuser@<public-ip>   # enter MyP@ssw0rd123 (for password VM)
```

Inside VM:

```bash
sudo apt update -y
sudo apt install apache2 -y
echo "<h1>Welcome to My Azure VM with Apache</h1>" | sudo tee /var/www/html/index.html
```

ðŸ‘‰ Open in browser â†’ `http://<public-ip>`

---

## **Part 9 â€“ List Resources**

```bash
# Resource Groups
az group list -o table

# VNets
az network vnet list -g LabRG -o table

# Subnets
az network vnet subnet list -g LabRG --vnet-name LabVNet -o table

# VMs
az vm list -g LabRG -o table

# NSGs
az network nsg list -g LabRG -o table

# All resources
az resource list -g LabRG -o table
```

---

## **Part 10 â€“ Cleanup (Delete Resources)**

Delete VM:

```bash
az vm delete --name LabVMKey --resource-group LabRG --yes
az vm delete --name LabVMPass --resource-group LabRG --yes
```

Delete Subnet:

```bash
az network vnet subnet delete \
  --name LabSubnet --vnet-name LabVNet --resource-group LabRG
```

Delete VNet:

```bash
az network vnet delete --name LabVNet --resource-group LabRG
```

Delete Resource Group (recommended â€“ removes all inside):

```bash
az group delete --name LabRG --yes --no-wait
```

---

âœ… **This Lab Covers:**

* User creation & Owner access (**GUI + CLI**)
* Azure CLI installation
* Login & identity check
* Subscription management
* RG, VNet, Subnet creation
* Linux VM deployment (**SSH key + password**)
* Apache (httpd) install
* Port opening (22 & 80)
* Resource listing (RG, VNet, Subnet, VM, NSG, All)
* Cleanup (VM, VNet, Subnet, RG)

---
