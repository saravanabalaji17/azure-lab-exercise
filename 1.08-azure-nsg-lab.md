
# 🔹 Lab Exercise: Azure NSG Practice (Attach Later)

### 🎯 Objective

* Create 2 Linux VMs without NSG.
* Create NSG separately and attach it later.
* Test traffic before and after NSG.

---

## 🛠️ Steps

### **Step 1: Create Resource Group**

* Name: **`studentname-rg`**
* Region: East US (or your choice).

---

### **Step 2: Create Virtual Network**

* Name: **`studentname-vnet`**
* Address space: `10.0.0.0/16`

**Subnet:**

* Name: **`studentname-subnet`**
* Address range: `10.0.1.0/24`

---

### **Step 3: Create 2 VMs (Without NSG)**

1. **VM1 (public access)**

   * Name: **`studentname-vm1`**
   * Public IP: Yes → **Name: `studentname-vm1-pip`**
   * NIC NSG: None
   * Subnet NSG: None

2. **VM2 (private only)**

   * Name: **`studentname-vm2`**
   * Public IP: **None**
   * NIC NSG: None
   * Subnet NSG: None

---

### **Step 4: Test Connectivity (Before NSG)**

1. SSH into **studentname-vm1** using its public IP.
2. From vm1 → ping **studentname-vm2 private IP** (`10.0.1.x`) → ✅ Works
3. From vm1 → SSH into vm2 (`ssh 10.0.1.x`) → ✅ Works
4. Install nginx on vm2 → `sudo apt install nginx -y`
5. From vm1 → `curl http://10.0.1.x` → ✅ Works (no NSG restrictions).

---

### **Step 5: Create NSG Separately**

* Name: **`studentname-nsg`**

**Add rules:**

| Rule Name                | Priority | Protocol | Port | Action | Notes      |
| ------------------------ | -------- | -------- | ---- | ------ | ---------- |
| `studentname-allow-ssh`  | 100      | TCP      | 22   | Allow  | SSH        |
| `studentname-allow-ping` | 200      | ICMP     | Any  | Allow  | ICMP       |
| `studentname-deny-http`  | 300      | TCP      | 80   | Deny   | Block HTTP |

---

### **Step 6: Associate NSG**

* Go to **`studentname-subnet`** → Associate NSG → Select **`studentname-nsg`**.
  *(Alternatively: associate at NIC level for each VM.)*

---

### **Step 7: Test Connectivity (After NSG)**

1. From vm1 → ping vm2 → ✅ Works
2. From vm1 → ssh vm2 → ✅ Works
3. From vm1 → `curl http://10.0.1.x` → ❌ Blocked (due to Deny rule)
4. Remove **deny-http** rule → retry → ✅ Works

---

### **Step 8: Cleanup**

Delete resource group: **`studentname-rg`**

---

✅ This way, every resource has a clear prefix:

* `studentname-rg`
* `studentname-vnet`
* `studentname-subnet`
* `studentname-vm1`, `studentname-vm2`
* `studentname-vm1-pip`
* `studentname-nsg`
* Rules: `studentname-allow-ssh`, `studentname-allow-ping`, `studentname-deny-http`

---
