

# ðŸ”¹ Lab Exercise: Create VMSS with Autoscaling

### âœ… Prerequisites

* Azure subscription
* Azure Portal access (weâ€™ll use **GUI**)
* Alternatively, you can run via **Azure CLI**

---

## **Step 1: Create a Resource Group**

**Azure Portal**

1. Go to **Resource groups â†’ + Create**.
2. Name: `vmss-lab-rg`
3. Region: Choose nearest region (e.g., East US).
4. Review + Create.

---

## **Step 2: Create the VM Scale Set**

1. In the Azure portal, search **Virtual machine scale sets â†’ + Create**.
2. Basics tab:

   * Subscription: your subscription
   * Resource group: `vmss-lab-rg`
   * Name: `myVMSS`
   * Region: East US
   * Orchestration Mode: **Uniform**
   * Image: Ubuntu Server 22.04 LTS (or Windows if you prefer)
   * Size: Standard\_B1s (small for lab)
   * Authentication: Password/SSH
3. Scaling tab:

   * Initial instance count: **2**
   * Scaling: Enable autoscale

---

## **Step 3: Configure Autoscale Rules**

1. Go to **Scaling â†’ Custom autoscale**.

2. Add a **rule for CPU**:

   * Metric: `Percentage CPU`
   * Condition: `Greater than 70%`
   * Action: Increase by 1 instance
   * Cooldown: 5 minutes

3. Add a **rule for Memory** (Memory metric needs **Azure Monitor Diagnostic extension** â†’ you must enable it):

   * Metric namespace: `Guest (Classic)`
   * Metric: `Available Memory`
   * Condition: `Less than 500 MB`
   * Action: Increase by 1 instance
   * Cooldown: 5 minutes

4. Add a **scale in rule**:

   * Metric: `Percentage CPU`
   * Condition: `Less than 30%`
   * Action: Decrease by 1 instance
   * Cooldown: 10 minutes

5. **Limits**:

   * Minimum: 2
   * Maximum: 5

---

## **Step 4: Networking**

* Select **Create new Load Balancer** (for inbound traffic).
* Leave defaults for simplicity.

---

## **Step 5: Review + Create**

* Validate and click **Create**.
* Wait for deployment (2â€“3 min).

---

## **Step 6: Generate CPU/Memory Load (to trigger scale out)**

1. Connect to one of the VMs in the VMSS via SSH.
2. Install **stress tool**:

   ```bash
   sudo apt update
   sudo apt install stress -y
   ```
3. Run stress test (CPU load):

   ```bash
   stress --cpu 2 --timeout 300
   ```
4. Or memory stress:

   ```bash
   stress --vm 1 --vm-bytes 600M --timeout 300
   ```
5. Monitor VMSS â†’ **Instances tab**. Youâ€™ll see it scale from 2 â†’ 3 â†’ â€¦ â†’ max 5 VMs.

---

## **Step 7: Verify Autoscaling**

* After load stops, CPU/Memory drops â†’ VMSS will automatically **scale in** back toward 2 VMs.
* You can confirm in **Metrics (Azure Monitor)**.

---

## **Cleanup**

To avoid charges:

```bash
delete RG```

---

âœ… **End Result:** You created a **VM Scale Set** with 2 initial VMs, autoscaling up to 5 based on **CPU and Memory** load.

---

Would you like me to also give you the **Azure CLI version** of this lab\*\* (with commands) so you can practice both Portal and CLI?
