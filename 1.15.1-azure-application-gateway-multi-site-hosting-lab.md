

# ðŸ”¹ Lab Exercise â€“ Multi-site Hosting with Application Gateway (Azure Portal GUI)

---

## **Step 1 â€“ Create Resource Group**

1. Go to **Azure Portal** â†’ **Resource groups** â†’ **Create**.
2. **Name** â†’ `studentname-rg`
3. **Region** â†’ East US (or your preferred region)
4. Click **Review + Create** â†’ **Create**

---

## **Step 2 â€“ Create Virtual Network**

1. Go to **Virtual networks** â†’ **Create**.
2. **Name** â†’ `studentname-vnet`
3. **Resource group** â†’ `studentname-rg`
4. **Address space** â†’ `10.0.0.0/16`
5. Add a **Subnet**:

   * `vm-subnet` â†’ `10.0.1.0/24`
6. Add another **Subnet** (for Application Gateway):

   * `appgw-subnet` â†’ `10.0.2.0/24`
7. Click **Review + Create** â†’ **Create**

---

## **Step 3 â€“ Create Two Linux VMs**

Repeat these steps twice (for `studentname-vm1` and `studentname-vm2`):

1. Go to **Virtual machines** â†’ **Create**.
2. **Name** â†’ `studentname-vm1` (and then `studentname-vm2`)
3. **Resource group** â†’ `studentname-rg`
4. **Image** â†’ Ubuntu Server 22.04 LTS
5. **Authentication** â†’ SSH key or Password
6. **Networking**:

   * Select `studentname-vnet`
   * Subnet: `vm-subnet`
   * Public IP: Enable (for initial testing)
   * Allow port 22 (SSH) and port 80 (HTTP)
7. **Review + Create** â†’ **Create**

---

## **Step 4 â€“ Install Apache & HTML**

SSH into both VMs (via their Public IPs) and run:

### On `studentname-vm1`

```bash
sudo apt update -y
sudo apt install apache2 -y
echo "<h1>Website 1 - studentname-vm1</h1>" | sudo tee /var/www/html/index.html
sudo systemctl enable --now apache2
```

### On `studentname-vm2`

```bash
sudo apt update -y
sudo apt install apache2 -y
echo "<h1>Website 2 - studentname-vm2</h1>" | sudo tee /var/www/html/index.html
sudo systemctl enable --now apache2
```

âœ… Test in browser:

* `http://<vm1-public-ip>`
* `http://<vm2-public-ip>`

---

## **Step 5 â€“ Create Application Gateway**

1. Go to **Application Gateways** â†’ **Create**.
2. **Name** â†’ `studentname-appgw`
3. **Resource group** â†’ `studentname-rg`
4. **Region** â†’ Same as VMs
5. **Tier** â†’ Standard v2
6. **Virtual network** â†’ `studentname-vnet`
7. **Subnet** â†’ `appgw-subnet`
8. **Frontend Public IP** â†’ Create new â†’ `studentname-appgw-pip`
9. Click **Review + Create** â†’ **Create**

---

## **Step 6 â€“ Configure Backend Pools**

1. Open `studentname-appgw` â†’ **Backend pools** â†’ **Add**

   * Name: `backendpool-vm1`
   * Target: Virtual machine â†’ Select `studentname-vm1`
   * Save
2. Add another pool:

   * Name: `backendpool-vm2`
   * Target: Virtual machine â†’ Select `studentname-vm2`
   * Save

---

## **Step 7 â€“ Configure Backend HTTP Settings**

1. Go to **Backend settings** â†’ **Add**

   * Name: `setting-vm1`
   * Protocol: HTTP
   * Port: 80
   * Save
2. Add another:

   * Name: `setting-vm2`
   * Protocol: HTTP
   * Port: 80
   * Save

---

## **Step 8 â€“ Configure Listeners (for Multi-site Hosting)**

1. Go to **Listeners** â†’ **Add listener**

   * Name: `listener-site1`
   * Frontend IP: Public
   * Frontend port: 80
   * Listener type: **Multi-site**
   * Hostname: `site1.studentname.com`
   * Save
2. Add second listener:

   * Name: `listener-site2`
   * Hostname: `site2.studentname.com`
   * Save

---

## **Step 9 â€“ Configure Routing Rules**

1. Go to **Rules** â†’ **Add rule**

   * Name: `rule-site1`
   * Listener: `listener-site1`
   * Backend target: `backendpool-vm1` + `setting-vm1`
   * Save
2. Add another rule:

   * Name: `rule-site2`
   * Listener: `listener-site2`
   * Backend target: `backendpool-vm2` + `setting-vm2`
   * Save

---

## **Step 10 â€“ Create DNS Zone**

1. Go to **DNS Zones** â†’ **Create**

   * Name: `studentname.com`
   * Resource group: `studentname-rg`
   * Create

---

## **Step 11 â€“ Add DNS Records**

1. Open DNS Zone â†’ **+ Record set**

   * Name: `site1`
   * Type: A
   * IP address: Public IP of `studentname-appgw-pip`
   * Save
2. Add another record:

   * Name: `site2`
   * Type: A
   * IP address: Public IP of `studentname-appgw-pip`
   * Save

---

## **Step 12 â€“ Test in Browser**

* Open: `http://site1.studentname.com` â†’ shows **Website 1**
* Open: `http://site2.studentname.com` â†’ shows **Website 2**

---

âœ… You now have:

* **Resource group:** `studentname-rg`
* **2 Linux VMs** (`studentname-vm1`, `studentname-vm2`)
* **Application Gateway** (`studentname-appgw`) with

  * 2 listeners, 2 backend pools, 2 backend settings, 2 rules
* **DNS Zone** (`studentname.com`) with records for both sites

---

