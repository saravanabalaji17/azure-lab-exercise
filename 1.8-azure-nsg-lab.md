
# 🔹 Lab Exercise: Practice Azure NSG

### 🎯 Objective

* Understand how **NSGs control inbound/outbound traffic**.
* Deploy 2 Linux VMs in the same VNet and test connectivity.
* Use NSG rules to **allow/deny** traffic.

---

## 🛠️ Steps

### **Step 1: Create Resource Group**

1. Go to **Azure Portal → Resource groups → Create**.

   * Name: `studentname-nsg-lab-rg`
   * Region: `East US` (or any).

---

### **Step 2: Create Virtual Network**

1. Go to **Virtual networks → Create**.

   * Name: `studentname-vnet`
   * Address space: `10.0.0.0/16`

2. Add **subnet**:

   * Name: `studentname-subnet`
   * Address range: `10.0.1.0/24`

---

### **Step 3: Create 2 VMs**

* VM1: `studentname-vm1` (Ubuntu/AlmaLinux) – Public IP enabled
* VM2: `studentname-vm2` – **No Public IP**
* Both in `studentname-subnet`.

---

### **Step 4: Create NSG**

1. Go to **Network Security Groups → Create**.

   * Name: `studentname-nsg`
   * Region: same as VNet

2. Associate `studentname-nsg` with **studentname-subnet**.

---

### **Step 5: Configure NSG Rules**

By default, NSG allows **outbound traffic** and denies inbound except **Azure defaults**.
Now add custom rules:

#### 🔹 Rule 1: Allow SSH

* Name: `Allow-SSH`
* Priority: `100`
* Direction: **Inbound**
* Source: Any
* Destination: Any
* Protocol: TCP
* Port: `22`
* Action: Allow

#### 🔹 Rule 2: Allow ICMP (Ping)

* Name: `Allow-Ping`
* Priority: `200`
* Protocol: ICMP
* Port: *Any*
* Action: Allow

#### 🔹 Rule 3: Deny Web (HTTP)

* Name: `Deny-HTTP`
* Priority: `300`
* Protocol: TCP
* Port: `80`
* Action: Deny

---

### **Step 6: Test NSG Behavior**

1. SSH into **VM1 (public IP)**.
2. From VM1 → Ping VM2’s private IP (`10.0.1.x`) → ✅ should work.
3. From VM1 → SSH into VM2 (`ssh 10.0.1.x`) → ✅ should work.
4. Install Nginx on VM2 (`sudo apt install nginx -y`).
5. From VM1 → `curl http://10.0.1.x` → ❌ should fail (because of Deny-HTTP).
6. Remove **Deny-HTTP rule** and try again → ✅ should work.

---

### **Step 7: Cleanup**

Delete `studentname-nsg-lab-rg` after testing.

---

✅ With this lab, you practiced:

* Creating NSG
* Associating with subnet
* Adding allow/deny rules
* Testing effect of rules

---
