1. Create an **Azure Linux VM**
2. Take a **snapshot of the OS disk**
3. Simulate **OS disk corruption**
4. **Recover** by creating a new OS disk from the snapshot
5. **Swap the OS disk** to restore the VM

---

# üîπ Lab Exercise: VM Recovery Using Snapshot

### **Step 1: Create an Azure Linux VM**

1. Go to **Azure Portal** ‚Üí **Virtual machines** ‚Üí **Create** ‚Üí **Azure virtual machine**
2. Fill details:

   * **Resource group**: `<studentname>-rg`
   * **VM name**: `<studentname>-linux-vm`
   * **Region**: (Choose closest region)
   * **Image**: AlmaLinux 9 (x64 Gen2)
   * **Authentication type**: SSH public key ‚Üí Generate new key pair
   * **Key name**: `<studentname>-key`
   * **Inbound ports**: Allow SSH (22)

Click **Review + Create ‚Üí Create**.

---

### **Step 2: Take Snapshot of OS Disk**

1. Go to your **VM** ‚Üí **Disks**
2. Click on the **OS Disk** (e.g., `studentname-linux-vm_OsDisk_1`)
3. In the disk blade, click **Create snapshot**
4. Provide:

   * **Snapshot name**: `studentname-osdisk-snap`
   * **Resource group**: `<studentname>-rg`
   * **Storage type**: Standard HDD (or Premium if needed)
5. Click **Review + Create ‚Üí Create**

---

### **Step 3: Corrupt OS Disk (Simulation)**

‚ö†Ô∏è Don‚Äôt try this on production. Just for lab.
SSH into VM:

```bash
# Example simulation of corruption
sudo rm -rf /boot/*
sudo shutdown -r now
```

After reboot, VM will fail to boot.

---

### **Step 4: Create New OS Disk from Snapshot**

1. Go to **Snapshots** ‚Üí Select `studentname-osdisk-snap`
2. Click **Create disk**
3. Fill details:

   * **Disk name**: `studentname-osdisk-recovery`
   * **Resource group**: `<studentname>-rg`
   * **Disk type**: Standard HDD / SSD
   * **Source type**: Snapshot
4. Click **Review + Create ‚Üí Create**

---

### **Step 5: Swap OS Disk on the VM**

1. Go to your **VM** ‚Üí **Overview** ‚Üí **Stop (deallocate)**
2. Then go to **Disks** ‚Üí **Swap OS disk**
3. Select new disk: `studentname-osdisk-recovery`
4. Save changes
5. Start the VM

---

‚úÖ Your VM should now boot successfully from the recovered OS disk!

