---

# ðŸ”¹ **Azure Advanced Lab Exercise**

---

## **Part 1 â€“ Create User & Assign Owner Role**

### (A) GUI (Azure Portal)

1. Go to **Azure Portal â†’ Microsoft Entra ID â†’ Users â†’ New User**

   * Create `labuser1@<tenant>.onmicrosoft.com` with password.
2. Go to **Subscriptions â†’ Access Control (IAM)**

   * Add role assignment â†’ **Owner** â†’ Select `labuser1`.

### (B) Azure CLI

```bash
# Create user
az ad user create \
  --display-name "Lab User 1" \
  --user-principal-name labuser1@<tenant>.onmicrosoft.com \
  --password "Pass@12345"

# Assign Owner role
az role assignment create \
  --assignee labuser1@<tenant>.onmicrosoft.com \
  --role Owner \
  --scope /subscriptions/<subscription-id>
```

---

## **Part 2 â€“ Install Azure CLI on Linux**

(Ubuntu/Debian example)

```bash
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
az version
```

Install Azure CLI on Ubuntu
```bash
# Update packages
sudo apt update

# Install prerequisites
sudo apt install -y ca-certificates curl apt-transport-https lsb-release gnupg

# Add Microsoft signing key
curl -sL https://packages.microsoft.com/keys/microsoft.asc |
sudo gpg --dearmor |
sudo tee /etc/apt/trusted.gpg.d/microsoft.gpg > /dev/null

# Add Azure CLI repo
AZ_REPO=$(lsb_release -cs)
echo "deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ $AZ_REPO main" |
sudo tee /etc/apt/sources.list.d/azure-cli.list

# Install Azure CLI
sudo apt update
sudo apt install -y azure-cli

verify:
az version
```
Install Azure CLI on Red Hat / RHEL / CentOS / Rocky / Alma
```bash
# Import Microsoft GPG key
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc

# Add Azure CLI repo
sudo tee /etc/yum.repos.d/azure-cli.repo <<EOF
[azure-cli]
name=Azure CLI
baseurl=https://packages.microsoft.com/yumrepos/azure-cli
enabled=1
gpgcheck=1
gpgkey=https://packages.microsoft.com/keys/microsoft.asc
EOF

# Install Azure CLI
sudo yum install -y azure-cli

verify:
az version
```
Install Azure CLI on Windows (CMD / PowerShell)
```bash
Download:
ðŸ‘‰ https://aka.ms/installazurecliwindows

Run the installer

Restart CMD / PowerShell

verify:
az version
```
---

## **Part 3 â€“ Login & Verify**

```bash
az login
az account show --query user
az role assignment list --assignee $(az account show --query user.name -o tsv) -o table
```

---

## **Part 4 â€“ Manage Subscription**

```bash
az account list -o table
az account set --subscription <subscription-id>
```

---

## **Part 5 â€“ Create Resource Group, VNet, Subnet**

```bash
# Resource Group
az group create --name LabRG --location eastus

# VNet + Subnet
az network vnet create \
  --resource-group LabRG \
  --name LabVNet \
  --address-prefix 10.0.0.0/16 \
  --subnet-name LabSubnet \
  --subnet-prefix 10.0.1.0/24
```

---

## **Part 6 â€“ Create Linux VMs**

### (A) **Two VMs with SSH Keys**

```bash
# VM1
az vm create \
  --resource-group LabRG \
  --name LabVM1 \
  --image UbuntuLTS \
  --admin-username azureuser \
  --generate-ssh-keys \
  --vnet-name LabVNet \
  --subnet LabSubnet

# VM2
az vm create \
  --resource-group LabRG \
  --name LabVM2 \
  --image UbuntuLTS \
  --admin-username azureuser \
  --generate-ssh-keys \
  --vnet-name LabVNet \
  --subnet LabSubnet
```

### (B) **VM with Password (reference only)**

```bash
az vm create \
  --resource-group LabRG \
  --name LabVMPass \
  --image UbuntuLTS \
  --admin-username azureuser \
  --admin-password 'MyP@ssw0rd123' \
  --authentication-type password \
  --vnet-name LabVNet \
  --subnet LabSubnet
```

---

## **Part 7 â€“ Open Ports (SSH & HTTP)**

```bash
# For all VMs
az vm open-port --resource-group LabRG --name LabVM1 --port 22
az vm open-port --resource-group LabRG --name LabVM1 --port 80

az vm open-port --resource-group LabRG --name LabVM2 --port 22
az vm open-port --resource-group LabRG --name LabVM2 --port 80
```

---

## **Part 8 â€“ Install Apache on Both VMs**

Get public IPs:

```bash
az vm list-ip-addresses -g LabRG -o table
```

SSH into each VM:

```bash
ssh azureuser@<public-ip-vm1>
ssh azureuser@<public-ip-vm2>
```

Inside each VM:

```bash
sudo apt update -y
sudo apt install apache2 -y
echo "<h1>Welcome to $(hostname)</h1>" | sudo tee /var/www/html/index.html
```

---

## **Part 9 â€“ Create Load Balancer & Add VMs**

### Public IP for LB

```bash
az network public-ip create \
  --resource-group LabRG \
  --name LabLBPublicIP \
  --allocation-method Static
```

### Load Balancer

```bash
az network lb create \
  --resource-group LabRG \
  --name LabLB \
  --sku Basic \
  --frontend-ip-name LabFrontEnd \
  --backend-pool-name LabBackEnd \
  --public-ip-address LabLBPublicIP
```

### Health Probe

```bash
az network lb probe create \
  --resource-group LabRG \
  --lb-name LabLB \
  --name LabHealthProbe \
  --protocol tcp \
  --port 80
```

### Load Balancer Rule

```bash
az network lb rule create \
  --resource-group LabRG \
  --lb-name LabLB \
  --name HTTPRule \
  --protocol tcp \
  --frontend-port 80 \
  --backend-port 80 \
  --frontend-ip-name LabFrontEnd \
  --backend-pool-name LabBackEnd \
  --probe-name LabHealthProbe
```

### Add VM NICs to Backend Pool

```bash
# VM1
az network nic ip-config address-pool add \
  --address-pool LabBackEnd \
  --ip-config-name ipconfigLabVM1 \
  --nic-name $(az vm show -d -g LabRG -n LabVM1 --query "networkProfile.networkInterfaces[0].id" -o tsv | cut -d'/' -f9) \
  --resource-group LabRG \
  --lb-name LabLB

# VM2
az network nic ip-config address-pool add \
  --address-pool LabBackEnd \
  --ip-config-name ipconfigLabVM2 \
  --nic-name $(az vm show -d -g LabRG -n LabVM2 --query "networkProfile.networkInterfaces[0].id" -o tsv | cut -d'/' -f9) \
  --resource-group LabRG \
  --lb-name LabLB
```

ðŸ‘‰ Test in browser â†’ `http://<LB-Public-IP>` â†’ you should see responses from **VM1 / VM2** alternately.

---

## **Part 10 â€“ List Resources**

```bash
# Resource Groups
az group list -o table

# VNets
az network vnet list -g LabRG -o table

# Subnets
az network vnet subnet list -g LabRG --vnet-name LabVNet -o table

# VMs
az vm list -g LabRG -o table

# NSGs
az network nsg list -g LabRG -o table

# Load Balancers
az network lb list -g LabRG -o table

# All Resources
az resource list -g LabRG -o table
```

---

## **Part 11 â€“ Cleanup**

```bash
# Delete individual VMs
az vm delete --name LabVM1 --resource-group LabRG --yes
az vm delete --name LabVM2 --resource-group LabRG --yes
az vm delete --name LabVMPass --resource-group LabRG --yes

# Delete VNet + Subnet
az network vnet delete --name LabVNet --resource-group LabRG

# Delete Load Balancer
az network lb delete --name LabLB --resource-group LabRG
az network public-ip delete --name LabLBPublicIP --resource-group LabRG

# Delete Resource Group (recommended, removes everything)
az group delete --name LabRG --yes --no-wait
```

---

âœ… **This Advanced Lab Covers:**

* User creation + RBAC (GUI + CLI)
* Azure CLI install & login
* Subscription management
* Resource Group, VNet, Subnet
* **2 Linux VMs (SSH keys)** + **1 VM with password (reference)**
* Apache installation on VMs
* Load Balancer with backend pool
* Open ports 22 & 80
* Listing resources (RG, VNet, Subnet, VM, NSG, LB, all)
* Cleanup




## **Azure VM Create â€“ FULL OPTIONS**

```bash
az vm create \
  --resource-group <RG_NAME> \
  --name <VM_NAME> \
  --location <LOCATION> \
  --image <IMAGE> \
  --size <VM_SIZE> \
  --admin-username <ADMIN_USER> \
  --admin-password <PASSWORD> \
  --authentication-type password|ssh \
  --ssh-key-values ~/.ssh/id_rsa.pub \
  --generate-ssh-keys \
  --public-ip-address <PIP_NAME> \
  --public-ip-sku Standard|Basic \
  --vnet-name <VNET_NAME> \
  --subnet <SUBNET_NAME> \
  --nsg <NSG_NAME> \
  --nsg-rule SSH|RDP|NONE \
  --private-ip-address <PRIVATE_IP> \
  --nic-delete-option Delete \
  --os-disk-name <OS_DISK_NAME> \
  --os-disk-size-gb <SIZE> \
  --os-disk-caching ReadWrite|ReadOnly \
  --storage-sku Standard_LRS|Premium_LRS|StandardSSD_LRS \
  --data-disk-sizes-gb 10 20 \
  --data-disk-caching ReadOnly \
  --boot-diagnostics-storage <STORAGE_ACCOUNT> \
  --enable-agent true \
  --custom-data cloud-init.txt \
  --availability-set <AVSET_NAME> \
  --zone 1 \
  --assign-identity \
  --role Contributor \
  --scope /subscriptions/<SUB_ID>/resourceGroups/<RG_NAME> \
  --tags env=dev app=web \
  --license-type RHEL_BYOS \
  --enable-hotpatching true \
  --security-type TrustedLaunch \
  --enable-secure-boot true \
  --enable-vtpm true \
  --priority Regular|Spot \
  --max-price -1 \
  --eviction-policy Deallocate

```




---
